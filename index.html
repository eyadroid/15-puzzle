<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Hind</title>
</head>
<body onload="onLoad()">
    <div class="main-container">
        <h1 class="title">15 puzzle game</h1>
        <div class="game-box" id="game-box"></div>
    </div>

    <script>
        const gameBox = document.getElementById('game-box');
        const boxSize = gameBox.clientWidth;

        const indexes = new Map();

        function onLoad() {
            initGame();
        }
        function initGame() {
            generateRandomNumbers();
            render();
        }

        function generateRandomNumbers() {
            const numbers = ["empty"];
            for (let i = 0; i < 16 - 1; i++) {
                const element = i+1;
                numbers.push(element);
            }

            for (let i = 0; i < 16; i++) {
                const element = i;
                const randomNumber = numbers[Math.floor(Math.random() * numbers.length)];
                updateItemLocation(element, randomNumber);
                numbers.splice(numbers.indexOf(randomNumber), 1);
            }
        }

        function render() {
            gameBox.innerHTML = "";
            for (let i = 0; i < 16; i++) {
                const element = i + 1;
                const text = getItemLocation(i)
                addItem(i, text, text == 'empty');
            }

            highlightItems();
        }

        function updateItemLocation(item, index) {
            indexes.set(item, index);
        }

        function getItemLocation(item, index) {
            return indexes.get(item);
        }

        function addItem(index, element, empty) {
            const item = document.createElement('div');
            item.classList.add('game-item');
            if (empty) {
                item.classList.add('game-item-empty');
            }
            item.style.width = `${getItemSize()}px`;
            item.style.height = `${getItemSize()}px`;
            item.innerText = element;
            item.id = `i${index}`;
            gameBox.appendChild(item);
            item.addEventListener("click", onItemClicked);
        }


        function onItemClicked(e) {
            const clicked = e.target;
            const clickedId = getElementId(clicked);
            const empty = getEmpty();
            const emptyId = getElementId(empty);
            
            if (!canGo(emptyId, clickedId)) return;


            updateItemLocation(clickedId, 'empty');
            updateItemLocation(emptyId, clicked.innerText);
            if (checkForWin()) {
                win();
            }
            render();
        }

        function checkForWin() {
            for (let i = 0; i < 16 - 1; i++) {
                if (indexes.get(i) != i +1) return false;
            }
            return true;
        }

        function win() {
            alert("You win!!");
            initGame();
        }
        
        function canGo(to, from) {
            const size = 4;
            let emptyColumn = Math.floor(to % size);
            let emptyRow = Math.floor(to / size);
            let clickedColumn = Math.floor(from % size);
            let clickedRow = Math.floor(from / size);

            const sameRow = emptyRow === clickedRow;
            const sameColumn = emptyColumn === clickedColumn;
            const columnDiff = emptyColumn - clickedColumn;
            const rowDiff = emptyRow - clickedRow;
            const diffColumn = Math.abs(columnDiff) === 1;
            const diffRow = Math.abs(rowDiff) === 1;
            const sameRowDiffColumn = sameRow && diffColumn;
            const sameColumnDiffRow = sameColumn && diffRow;
            if (sameRowDiffColumn || sameColumnDiffRow) {
                return true;
            } else {
                return false;
            }
        }
        

        function getEmpty() {
            const element = document.querySelector('.game-item-empty');
            return element;
        }

        function getElementId(element) {
            return parseInt(element.id.split("i")[1], 0);
        }

        function getItemSize() {
            return (boxSize / 4);
        }

    </script>
</body>
</html>
